
<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>Add book information</title>
<link rel="stylesheet" type="text/css" href="css/General.css"/>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

	

function checkValid()
{

	var name=document.getElementById("name").value;
	var author=document.getElementById("author").value;
	var ISBN = document.getElementById("ISBN").value;
	var publish_date = document.getElementById("publish_date").value;
	var edition = document.getElementById("edition").value;
	var category = document.getElementById("category").value;
	var publish_firm = document.getElementById("publish_firm").value;
	var cover_image = document.getElementById("cover_image").value;
	
	if(name=="")
    {
		alert("bookname must be filled");
	}
	else if (ISBN == "")
	{
	    alert("ISBN must be filled");
	}

	else if(author=="")
	{
		alert("author name must be filled");
	}
	else
	{
	$.get(cover_image)
    .done(function() { 
        //Now you know the image exists.
				$.post('http://127.0.0.1:8000/api/add_book/',
				{
				    'session_key': getCookie('session_key'),
					  'name': name,
					  'author': author,
					  'ISBN': ISBN,
					  'publish_date': publish_date,
					  'edition': edition,
					  'category':category,
					  'publish_firm': publish_firm,
					  'cover_image':cover_image


				}, bookinfoCallBack);
    }).fail(function() { 
        // Image doesn't exist 
		alert('That image does no exist!');
    })


		
	}
}


function bookinfoCallBack(data) {
    console.log(data);
    if (data.status =="success") {
        window.location = 'main.html';
    } else {
    	$("text#bookname").val('');
    	$("text#author").val('');
        alert(data.reason);
    }
}
</script>
</head>
<body>
<h1 style="color:white;">New Book</h1>
<div class="addbook_panel" style="text-align: center">
    <form>
        <p align="center">
            Please enter the ISBN:&nbsp<input type="text" style="border:1px solid black" id="ISBN"></input><br><br></br>
            Please enter the book name:&nbsp<input type="text" style="border:1px solid black" id="name"></input><br><br></br>
            Please enter the publish date:&nbsp<input type="date" style="border:1px solid black" id="publish_date"></input><br><br></br>
            Please enter the author name:&nbsp<input type="text" style="border:1px solid black" id="author"></input><br><br></br>
            Please enter the edition:&nbsp<input type="text" style="border:1px solid black" id="edition"></input><br><br></br>
            Please enter the category:&nbsp<input type="text" style="border:1px solid black" id="category"></input><br><br></br>
            Please enter the publish firm:&nbsp<input type="text" style="border:1px solid black" id="publish_firm"></input><br><br></br>


            <h4>Please enter the url of the book image:</h4>
            <textarea name="cover_image" id="cover_image" rows="4" cols="50" style="font-family:sans-serif;border:1px solid black;"></textarea><br></br>
            <div>
                <button type="button" id="book_submit" style="width:100px;height:50px;" onclick="checkValid()">Submit</button>
            </div>
        </p>
    </form>
</div>
</body>
</html>