<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Raleway:100,600" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script src="https://www.promisejs.org/polyfills/promise-6.1.0.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <!--<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>-->
    <!--<script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!--Page title-->
    <title>Login</title>
    <!-- Styles -->
    <link rel="stylesheet" type="text/css" href="css/login.css"/>
</head>
<body>
<div class="col-lg-4 col-lg-push-4 col-md-6 col-md-push-3 col-sm-6 col-sm-push-3 col-xs-8 col-xs-push-2 login_panel">
    <div class="row">
        <div class="">
            <div class="panel panel-default">
                <div style="text-align: center">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="150.000000pt" height="70.000000pt"
                         viewBox="0 300 700.000000 400.000000" preserveAspectRatio="xMidYMid meet">
                        <metadata>
                            Created by potrace 1.12, written by Peter Selinger 2001-2015
                        </metadata>
                        <g transform="translate(0.000000,700.000000) scale(0.100000,-0.100000)" fill="#000000"
                           stroke="none">
                            <path d="M1731 2356 c-8 -10 -10 -243 -9 -862 l3 -849 240 0 240 0 0 642 0
                                        642 -27 28 c-16 16 -28 34 -28 40 0 5 14 27 30 48 30 38 30 38 30 169 0 89 -4
                                        136 -12 144 -18 18 -451 17 -467 -2z m323 -139 c14 -10 16 -25 14 -77 l-3 -65
                                        -88 -3 c-57 -2 -94 1 -103 9 -20 16 -19 113 2 133 20 20 151 22 178 3z m-3
                                        -297 c18 -10 19 -27 19 -563 0 -417 -3 -556 -12 -565 -19 -19 -163 -16 -182 4
                                        -14 14 -16 78 -16 559 0 481 2 545 16 559 18 19 143 23 175 6z">
                            </path>
                            <path d="M2362 2360 l-22 -9 2 -853 3 -853 235 0 235 0 3 850 c2 790 1 851
                                        -15 863 -20 14 -404 16 -441 2z m308 -140 c13 -8 15 -99 18 -701 2 -610 1
                                        -695 -13 -715 -14 -22 -23 -24 -88 -24 -124 0 -112 -81 -112 730 0 612 2 702
                                        15 710 19 13 161 13 180 0z">
                            </path>
                            <path d="M2960 2351 c-7 -14 -9 -293 -8 -863 l3 -843 240 0 240 0 3 843 c1
                                        570 -1 849 -8 863 -10 18 -23 19 -235 19 -212 0 -225 -1 -235 -19z m321 -131
                                        c19 -10 19 -29 19 -716 l0 -704 -26 -10 c-34 -13 -140 -13 -165 0 -18 10 -19
                                        29 -19 713 0 534 3 706 12 715 15 15 152 16 179 2z">
                            </path>
                            <path d="M3930 2360 c-12 -7 -16 -39 -20 -147 l-5 -138 -88 -3 c-57 -2 -94 1
                                        -103 9 -11 9 -14 40 -14 129 0 65 -3 125 -6 134 -5 12 -21 16 -65 16 -53 0
                                        -59 -2 -64 -22 -3 -13 -4 -399 -3 -858 l3 -835 65 0 65 0 3 633 2 633 26 9
                                        c36 14 147 12 167 -2 16 -12 17 -65 19 -643 l3 -630 65 0 65 0 3 636 2 636
                                        -30 38 c-37 47 -38 63 -2 91 27 22 27 24 30 152 4 157 -1 172 -61 172 -23 0
                                        -49 -5 -57 -10z">
                            </path>
                            <path d="M4198 2359 c-17 -9 -18 -55 -18 -733 l0 -724 23 -6 c12 -3 86 -6 165
                                        -6 l142 0 11 -27 c5 -15 9 -66 8 -114 -1 -48 1 -92 5 -98 8 -13 112 -15 120
                                        -2 3 5 6 388 6 852 1 788 0 845 -17 856 -24 18 -88 16 -103 -2 -10 -12 -12
                                        -150 -11 -646 2 -561 0 -633 -14 -655 -14 -22 -22 -24 -95 -24 -70 0 -81 2
                                        -94 22 -14 20 -16 99 -16 658 0 481 -3 639 -12 648 -15 15 -76 15 -100 1z">
                            </path>
                            <path d="M4801 2356 c-8 -10 -10 -243 -9 -862 l3 -849 240 0 240 0 3 849 c1
                                        619 -1 852 -9 862 -13 16 -82 18 -110 4 -19 -10 -19 -30 -19 -773 0 -674 -2
                                        -765 -16 -785 -13 -19 -24 -22 -85 -22 -122 0 -109 -94 -109 790 0 685 -2 770
                                        -16 784 -19 20 -97 21 -113 2z">
                            </path>
                        </g>
                    </svg>
                </div>
                <div class="panel-body">
                    <!--<form class="form-horizontal">-->
                    <div>
                        <label for="email" class="control-label">E-Mail Address</label>
                        <div>
                            <input id="email" type="email" class="form-control text" name="email" autofocus>
                        </div>
                        <div class="error_msg" id="error_email">
                            {{message1}}
                        </div>
                        <div class="error_msg" id="error_ban">
                            {{message3}}
                        </div>
                    </div>

                    <div>
                        <label for="password" class="control-label">Password</label>
                        <div>
                            <input id="password" type="password" class="form-control text" name="password">
                        </div>
                        <div class="error_msg" id="error_pwd">
                            {{message2}}
                        </div>
                    </div>

                    <div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="remember"> Remember Me
                            </label>
                        </div>
                    </div>
                    <p style="font-size: 10px;">Don't have an account? Please <a href="signup.html">sign up</a> here.</p>
                    <div>
                        <button class="btn btn-primary signin">
                            Login
                        </button>
                        <a class="btn btn-link forget_pwd">
                            Forgot Your Password?
                        </a>
                    </div>
                    <!--</form>-->
                </div>
            </div>
        </div>
    </div>
</div>
<script>

    $("button.signin").click(login);

    function login() {
        if($("input#email").val().length == 0 || $("input#password").val().length == 0)
        {
            alert("Missing Field");
        }
        else
        {
            console.log("login");
            $.post('http://127.0.0.1:8000/api/login/',
                {
                    'e_mail': $("#email").val(),
                    'password': $("#password").val()
                }
                , loginCallBack);
        }
        
    }

    function loginCallBack(data) {
        console.log(data);
        if (data.status === "success") {
            console.log(data.session_key);
            setCookie("session_key", data.session_key, 1800);
            window.location = 'main.html';
        } else {
            if(data.reason==="no such user")
            {

                $('.error_msg').hide();
                var error1= new Vue({
                el: "#error_email",
                data: {
                    message1: 'The e-mail address does not match credential'
                }
            })

                var error3= new Vue({
                el: '#error_pwd',
                data: {
                message2: 'The password does not match credential'
                }
             })

                $('#error_email').show();
                $('#error_pwd').show();
                $("#email").val('');
                $("#password").val('');
            }
            else if(data.reason==="permission denied")
            {

                $('.error_msg').hide();
                var error2= new Vue({
                el: '#error_ban',
                data: {
                    message3: 'The e-mail address was banned'
                }
             })
                
                $('#error_ban').show();
                $("#email").val('');
                $("#password").val('');
            }

        }
    }

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    function setCookie(cname, cvalue, sec) {
        var d = new Date();
        d.setTime(d.getTime() + (sec * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        console.log("cookie", document.cookie)
    }
</script>
</body>

</html>